<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Java Collections.List 集合工具类一(List)</title>
    <url>/2020/12/09/java-collections-list/</url>
    <content><![CDATA[<p>Java Collections Framework is one of the most essential Java API. The API provides implementations of standard data structure in Java-like linked list, set, stack, queue, hash table, priority queue and others. A <code>collection</code> represents a single unit of objects. The <code>collection framework</code> represents a unified architecture for storing and manipulating a group of objects</p>
<p><img src="/2020/12/09/java-collections-list/overview.jpg" alt="overview"></p>
<a id="more"></a>

<h1 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h1><h2 id="List-Interface"><a href="#List-Interface" class="headerlink" title="List Interface"></a>List Interface</h2><p>The <code>List</code> interface provides a way to store the ordered collection. It is a child interface of <a href="https://www.geeksforgeeks.org/collections-in-java-2/">Collection</a>. It is an ordered collection of objects in which duplicate values can be stored. Since List preserves the insertion order, it allows positional access and insertion of elements.</p>
<h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a><code>ArrayList</code></h3><p>Resizable-array implementation of the <code>List</code> interface. Permits all elements, including <code>null</code>. <code>ArrayList</code> is <code>not synchronized</code>. ArrayList implements <code>RandomAccess</code>, <code>Cloneable</code>, <code>Serializable</code>. Its equivalent synchronized class in Java is <code>Vector</code>. </p>
<p>Default capacity of ArrayList is 10. Once maximum capacity is reached, it increments as following:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">New capacity &#x3D; (current capacity * 3&#x2F;2) + 1</span><br></pre></td></tr></table></figure>

<p>Upon every increment cycle, ArrayList increases it size by around <strong><em>50%</em></strong> of original.</p>
<p>Dynamic expansion:</p>
<ul>
<li>Creates a bigger sized memory on heap memory.</li>
<li>Copies the current memory elements to the new memory.</li>
<li>New items added to the new memory.</li>
<li>Delete the old memory.</li>
</ul>
<hr>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a><code>LinkedList</code></h3><p>Doubly-linked list implementation of the <code>List</code> and <code>Deque</code> interfaces. Implements all optional list operations, and permits all elements (including <code>null</code>). Operations that index into the list will traverse the list from the beginning or the end, whichever is closer to the specified index. <code>LinkedList</code> is <code>not synchronized</code>. LinkedList implements <code>Serializable</code>, <code>Cloneable</code>, <code>Deque&lt;E&gt;</code>, <code>Queue&lt;E&gt;</code>. </p>
<p>Acts like a dynamic array:</p>
<ul>
<li>No need to specify the size upon initialization.</li>
<li>Size increases dynamically (add, remove)</li>
<li>Elements are not stored in continuous fashion.</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"># Add Elements</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span>	# appends the specific element to the end of the list</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> # inserts the specified element at specified position</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt;c)</span> # appends all of the elements to the end</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> # inserts the element at the beginning</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> # appends the element at the end</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function"># Search Elements</span></span><br><span class="line"><span class="function">Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> # returns the element at specified position</span></span><br><span class="line"><span class="function">Object <span class="title">getFirst</span><span class="params">()</span> # returns the first element</span></span><br><span class="line"><span class="function">object <span class="title">getLast</span><span class="params">()</span> # returns the last element</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># Update Elements</span></span><br><span class="line"><span class="function">E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> # replace the element at the specified position</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function"># Remove Elements</span></span><br><span class="line"><span class="function">E <span class="title">remove</span><span class="params">()</span> # removes the element at the beginning</span></span><br><span class="line"><span class="function">E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> # removes the element at the specified position</span></span><br><span class="line"><span class="function">E <span class="title">removeFirst</span><span class="params">()</span> # removes and returns the first element</span></span><br><span class="line"><span class="function">E <span class="title">removeLast</span><span class="params">()</span> # removes and returns the last element</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># Retrieve <span class="title">Elements</span> <span class="params">(does not remove)</span></span></span><br><span class="line"><span class="function">E <span class="title">peek</span><span class="params">()</span> # retrieves, but does not remove the first <span class="title">element</span> <span class="params">(head)</span></span></span><br><span class="line"><span class="function">E <span class="title">peekFirst</span><span class="params">()</span> # retrieves, but does not remove the first <span class="title">element</span> <span class="params">(returns <span class="keyword">null</span> <span class="keyword">if</span> empty)</span></span></span><br><span class="line"><span class="function">E <span class="title">peekLast</span><span class="params">()</span> # retrieves, but does not remove the last <span class="title">element</span> <span class="params">(returns <span class="keyword">null</span> <span class="keyword">if</span> empty)</span>  </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># Retrieve <span class="title">Elements</span> <span class="params">(and remove)</span></span></span><br><span class="line"><span class="function">E <span class="title">poll</span><span class="params">()</span> # retrieves, and removes the first <span class="title">element</span> <span class="params">(head)</span></span></span><br><span class="line"><span class="function">E <span class="title">pollFirst</span><span class="params">()</span> # retrieves and removes the first <span class="title">element</span> <span class="params">(returns <span class="keyword">null</span> <span class="keyword">if</span> empty)</span></span></span><br><span class="line"><span class="function">E <span class="title">pollLast</span><span class="params">()</span> # retrieves and removes the last <span class="title">element</span> <span class="params">(returns <span class="keyword">null</span> <span class="keyword">if</span> empty)</span>  </span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function"># Stack like operation</span></span><br><span class="line"><span class="function">E <span class="title">pop</span><span class="params">()</span> # pops an element from the stack represented by <span class="keyword">this</span> list</span></span><br><span class="line"><span class="function">E <span class="title">push</span><span class="params">(E e)</span> # pushes an element onto the stack represented by <span class="keyword">this</span> list</span></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a><code>Vector</code></h3><p>The <strong>Vector</strong> class implements a growable array of objects. Vectors basically fall in legacy classes but now it is fully compatible with collections. It can grow or shrink as required. <code>Vector</code> is similar to <code>ArrayList</code> but it is <code>synchronized</code>. Rarely used in non-thread environment due to poor performance in add, search, delete and update operations.</p>
<p>If the vector increment is not specified then it’s capacity will be doubled in every increment cycle.</p>
<hr>
<h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a><code>Stack</code></h3><p>The <code>Stack</code> class is based on the basic principle of <code>last-in-first-out</code>. In addition to the basic push and pop operations, the class provides three more functions of empty, search, and peek.</p>
<p>A more complete and consistent set of LIFO stack operations is provided by the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html"><code>Deque</code></a> interface and its implementations,</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Deque&lt;Integer&gt; stack = <span class="keyword">new</span> ArrayDeque&lt;Integer&gt;();</span><br></pre></td></tr></table></figure>

<p>Generally, <code>Deque</code> is better as:</p>
<ul>
<li>in terms of object orient design as it is an interface whereas <code>Stack</code> is a class. Using <code>Deque</code>removes the dependency on concret <code>Stack</code> class. </li>
<li><code>Stack</code> extends <code>Vector</code> and allows elements to be accessed by index. It is inconsistent with what general LIFO data structures should provide for.</li>
<li>Performance. <code>Stack</code> is synchronized which could introduce performance overheads.</li>
</ul>
<hr>
<h3 id="Performance-Comparison"><a href="#Performance-Comparison" class="headerlink" title="Performance Comparison"></a>Performance Comparison</h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">ArrayList</th>
<th align="center">LinkedList</th>
</tr>
</thead>
<tbody><tr>
<td align="center">get(index)</td>
<td align="center">O(1)</td>
<td align="center">O(n)</td>
</tr>
<tr>
<td align="center">add(E)</td>
<td align="center">O(1)</td>
<td align="center">O(1)</td>
</tr>
<tr>
<td align="center">add(index, E)</td>
<td align="center">O(n)</td>
<td align="center">O(n)</td>
</tr>
<tr>
<td align="center">remove(index)</td>
<td align="center">O(n)</td>
<td align="center">O(n)</td>
</tr>
</tbody></table>
<p>Time complexity:</p>
<p><code>ArrayList</code> is <strong><em>faster</em></strong> for <strong><em>accessing</em></strong> specific elements as it allows <code>RandomAccess</code>. Especially slow for deleting at middle.</p>
<p><code>LinkedList</code> is <strong><em>faster</em></strong> for <strong><em>adding</em></strong> and <strong><em>deleting</em></strong> elements. It is <code>slow</code> to access an element.</p>
]]></content>
      <categories>
        <category>Java Road Map</category>
      </categories>
      <tags>
        <tag>Java Basics</tag>
        <tag>Collections</tag>
        <tag>List</tag>
      </tags>
  </entry>
  <entry>
    <title>Build Blog with Hexo + Github + NexT</title>
    <url>/2020/12/09/hello-world/</url>
    <content><![CDATA[<p>This is my very first blog post on how to build a blog site powered by Github.io, Hexo and NexT. It won’t take even 10 minutes to set things up and running. It is fairly simple and easy to maintain. Let’s get started!</p>
<a id="more"></a>

<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><h3 id="Install-Node-js-amp-npm-with-Homebrew"><a href="#Install-Node-js-amp-npm-with-Homebrew" class="headerlink" title="Install Node.js &amp; npm with Homebrew"></a>Install Node.js &amp; npm with Homebrew</h3><p>More info: <a href="https://nodejs.org/en/download/package-manager/">Node.js</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ brew install node</span><br></pre></td></tr></table></figure>

<h3 id="Install-Hexo"><a href="#Install-Hexo" class="headerlink" title="Install Hexo"></a>Install <a href="https://hexo.io/docs/">Hexo</a></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure>
<h3 id="Initialize-Hexo-Blog-project"><a href="#Initialize-Hexo-Blog-project" class="headerlink" title="Initialize Hexo Blog project"></a>Initialize Hexo Blog project</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo init hexo-site</span><br><span class="line">$ <span class="built_in">cd</span> hexo-site</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
<h3 id="Install-Theme-NexT"><a href="#Install-Theme-NexT" class="headerlink" title="Install Theme - NexT"></a>Install Theme - <a href="https://theme-next.js.org/docs/getting-started/">NexT</a></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> hexo-site</span><br><span class="line">$ ls</span><br><span class="line">_config.yml  node_modules  package-lock.json  package.json  scaffolds  <span class="built_in">source</span>  themes</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>



<h2 id="Github-io"><a href="#Github-io" class="headerlink" title="Github.io"></a>Github.io</h2><h3 id="Create-a-repository-on-Github-with-name-username-github-io"><a href="#Create-a-repository-on-Github-with-name-username-github-io" class="headerlink" title="Create a repository on Github with name {username}.github.io:"></a>Create a repository on Github with name {username}.github.io:</h3><p><img src="/2020/12/09/hello-world/github.png" alt="github"></p>
<h3 id="Install-hexo-git-plugin"><a href="#Install-hexo-git-plugin" class="headerlink" title="Install hexo git plugin"></a>Install hexo git plugin</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>



<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><h3 id="Deploy-on-Github"><a href="#Deploy-on-Github" class="headerlink" title="Deploy on Github"></a>Deploy on Github</h3><p>Modify the <code>deploy</code> in  <code>hexo-site/_config.yml</code> file:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: https://github.com/&#123;username&#125;/&#123;username&#125;.github.io.git</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure>
<h3 id="Set-NexT-as-Theme"><a href="#Set-NexT-as-Theme" class="headerlink" title="Set NexT as Theme"></a>Set NexT as Theme</h3><p>Again, modify the <code>theme</code> in the same <code>hexo-site/_config.yml</code> file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">theme: next</span><br></pre></td></tr></table></figure>



<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>Now you can access the local bog site at <a href="http://localhost:4000/">http:localhost:4000</a></p>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
<p>Now your project has been deployed to Github repository and you can access your blog site at <a href="%7Busername%7D.github.io">{username}.github.io</a></p>
<h2 id="Additional-Information"><a href="#Additional-Information" class="headerlink" title="Additional Information"></a>Additional Information</h2><p>Now you are ready to start working on the blog. More Hexo configuration guide can be found at:</p>
<p><a href="https://hexo.io/docs/configuration.html">https://hexo.io/docs/configuration.html</a></p>
<p>Documentation for NexT theme setting can be found at: </p>
<p><a href="https://theme-next.js.org/docs/theme-settings/">https://theme-next.js.org/docs/theme-settings/</a></p>
]]></content>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Java Collections.Set 集合工具类二(Set)</title>
    <url>/2020/12/11/java-collections-set/</url>
    <content><![CDATA[<h2 id="Set-Interface-Overview"><a href="#Set-Interface-Overview" class="headerlink" title="Set Interface Overview"></a>Set Interface Overview</h2><p><img src="/2020/12/11/java-collections-set/overview.jpg" alt="overview"></p>
<p>A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a> is a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a> that cannot contain duplicate elements. It contains only methods inherit from <code>Collection</code> and adds the restriction that duplicate elements are prohibited. <code>Set</code> adds a strong contract on the behavior of the <code>equals</code> and <code>hashCode</code> operations. Two sets are equal if if they contain the same elements.</p>
]]></content>
      <categories>
        <category>Java Road Map</category>
      </categories>
      <tags>
        <tag>Java Basics</tag>
        <tag>Collections</tag>
        <tag>Set</tag>
      </tags>
  </entry>
  <entry>
    <title>Java Collections.Queue 集合工具类二(Queue)</title>
    <url>/2020/12/09/java-collections-queue/</url>
    <content><![CDATA[<h2 id="Queue-Interface-Overview"><a href="#Queue-Interface-Overview" class="headerlink" title="Queue Interface Overview"></a>Queue Interface Overview</h2><p><img src="/2020/12/09/java-collections-queue/overview.jpg" alt="overview"></p>
<p><code>Queue</code> is a collection designed for holding elements prior to processing. Besides basic <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html"><code>Collection</code></a> operations, queues provide additional insertion, extraction, and inspection operations. Each of these methods exists in two forms: </p>
<a id="more"></a>

<ul>
<li>one throws an exception if the operation fails</li>
<li>the other returns a special value (either <code>null</code> or <code>false</code>, depending on the operation). </li>
</ul>
<p>The latter form of the insert operation is designed specifically for use with capacity-restricted <code>Queue</code> implementations; in most implementations, insert operations cannot fail.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">throws Exception</th>
<th align="center">Returns special value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">insert</td>
<td align="center">add(e)</td>
<td align="center">offer(e)</td>
</tr>
<tr>
<td align="center">remove</td>
<td align="center">remove()</td>
<td align="center">poll()</td>
</tr>
<tr>
<td align="center">examine</td>
<td align="center">element()</td>
<td align="center">peek()</td>
</tr>
</tbody></table>
<hr>
<h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a><code>PriorityQueue</code></h3><h4 id="Basic-Concept"><a href="#Basic-Concept" class="headerlink" title="Basic Concept"></a>Basic Concept</h4><p>A priority queue is an Abstract Data Type that operates similar to a normal queue except that <strong><em>each element has a certain priority</em></strong>. The priority of the element in the priority queue determine the order in which elements are removed from the PQ.</p>
<p>The most common implementation of a PQ is using <code>binary heap</code> (二叉小顶堆).</p>
<p><img src="/2020/12/09/java-collections-queue/priorityqueue.jpg" alt="overview"></p>
<p>Indexing:</p>
<ul>
<li>Parent node index : i</li>
<li>Left child node index : 2i</li>
<li>Right child node index : 2i + 1</li>
<li>Parent node = ( node_index - 1 )  / 2 </li>
</ul>
<hr>
<p><strong>Strength</strong>:</p>
<ul>
<li>Quickly access the highest-priority item. Peek at the top item in <strong><em>O(1)</em></strong> while keeping other operations relatively cheap <strong><em>O(log(n))</em></strong>.</li>
</ul>
<p><strong>Weakness</strong>:</p>
<ul>
<li>Slow enqueues and dequeues. Both operations take <strong><em>O(log(n))</em></strong> time with priority queues. With normal FIFO queues, the operations are <strong><em>O(1)</em></strong> time.</li>
</ul>
<hr>
<h4 id="Java-API"><a href="#Java-API" class="headerlink" title="Java API"></a>Java API</h4><p>A <code>PriorityQueue</code> is used when the objects are supposed to be processed based on the priority. It is known that a <a href="https://www.geeksforgeeks.org/queue-interface-java/">Queue</a> follows the <code>First-In-First-Out</code> algorithm. The PriorityQueue is based on the priority heap. The elements of the priority queue are ordered according to the natural ordering, or by a Comparator provided at queue construction time, depending on which constructor is used. It implements <code>Serializable</code>, <code>Iterable&lt;E&gt;</code>, <code>Collection&lt;E&gt;</code>,  <code> Queue</code> interfaces.</p>
<p>Characteristics:</p>
<ul>
<li>Does not permit <code>null</code></li>
<li>Can’t create PriorityQueue of objects that are non-comparable</li>
<li>PriorityQueue are unbounded queues</li>
<li>Not thread-safe, use <code>PriorityBlockingQueue</code> class for multi-threading</li>
<li><strong><em>O(log(n))</em></strong> for <code>add</code> and <code>poll</code></li>
</ul>
<hr>
<h5 id="Insert-Element-and-ShiftUp"><a href="#Insert-Element-and-ShiftUp" class="headerlink" title="Insert Element and ShiftUp"></a>Insert Element and ShiftUp</h5><p><code>add(e)</code> and <code>offer(e)</code> are equivalent except for the exception handling. add(e) throws exception while offer(e) returns null.</p>
<p><img src="/2020/12/09/java-collections-queue/insert.png" alt="insert"></p>
<p><code>Offer(e)</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> i = size;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= queue.length)</span><br><span class="line">        grow(i + <span class="number">1</span>);</span><br><span class="line">    size = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        queue[<span class="number">0</span>] = e;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftUp(i, e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>siftUp(i, e)</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">        siftUpUsingComparator(k, x);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftUpComparable(k, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUpComparable</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    Comparable&lt;? <span class="keyword">super</span> E&gt; key = (Comparable&lt;? <span class="keyword">super</span> E&gt;) x;</span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> parent = (k - <span class="number">1</span>) &gt;&gt;&gt; <span class="number">1</span>; <span class="comment">// parent node = (node-1)/2</span></span><br><span class="line">        Object e = queue[parent];</span><br><span class="line">        <span class="keyword">if</span> (key.compareTo((E) e) &gt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        queue[k] = e;</span><br><span class="line">        k = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[k] = key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Peek-Element"><a href="#Peek-Element" class="headerlink" title="Peek/Element"></a>Peek/Element</h5><p><code>peek()</code> and <code>element()</code> are equivalent except for the exception handling. <code>peek()</code> returns <code>null</code> while <code>element()</code> throws exception.</p>
<p>peek() implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (size == <span class="number">0</span>) ? <span class="keyword">null</span> : (E) queue[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Remove-head-element"><a href="#Remove-head-element" class="headerlink" title="Remove head element"></a>Remove head element</h5><p><code>poll()</code> and <code>remove()</code> are equivalent except for the exception handling. <code>remove()</code> returns <code>null</code> while <code>poll()</code> throws exception.</p>
<p><img src="/2020/12/09/java-collections-queue/remove.png" alt="remove"></p>
<p><code>poll()</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> s = --size;</span><br><span class="line">    modCount++;</span><br><span class="line">    E result = (E) queue[<span class="number">0</span>];</span><br><span class="line">    E x = (E) queue[s];</span><br><span class="line">    queue[s] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="number">0</span>)</span><br><span class="line">        siftDown(<span class="number">0</span>, x);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>shiftDown(i, e)</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">        siftDownUsingComparator(k, x);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftDownComparable(k, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDownComparable</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    Comparable&lt;? <span class="keyword">super</span> E&gt; key = (Comparable&lt;? <span class="keyword">super</span> E&gt;)x;</span><br><span class="line">    <span class="keyword">int</span> half = size &gt;&gt;&gt; <span class="number">1</span>;        <span class="comment">// loop while a non-leaf</span></span><br><span class="line">    <span class="keyword">while</span> (k &lt; half) &#123;</span><br><span class="line">        <span class="keyword">int</span> child = (k &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>; <span class="comment">// assume left child is least</span></span><br><span class="line">        Object c = queue[child];</span><br><span class="line">        <span class="keyword">int</span> right = child + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp;</span><br><span class="line">            ((Comparable&lt;? <span class="keyword">super</span> E&gt;) c).compareTo((E) queue[right]) &gt; <span class="number">0</span>)</span><br><span class="line">            c = queue[child = right];</span><br><span class="line">        <span class="keyword">if</span> (key.compareTo((E) c) &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        queue[k] = c;</span><br><span class="line">        k = child;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[k] = key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Remove-specific-element"><a href="#Remove-specific-element" class="headerlink" title="Remove specific element"></a>Remove specific element</h5><p>There are two scenarios:</p>
<ul>
<li><p>The element to be removed is the last element:</p>
<ul>
<li>Delete immediately without modifying the queue structure</li>
</ul>
</li>
<li><p>The element is at somewhere else:</p>
<ul>
<li>Apply shiftDown from the element to be removed with the last element in the queue.</li>
</ul>
</li>
</ul>
<p><img src="/2020/12/09/java-collections-queue/removeat.png" alt="removeat"></p>
<p><code>remove(o)</code> implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = indexOf(o);</span><br><span class="line">    <span class="keyword">if</span> (i == -<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        removeAt(i);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">removeAt</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert i &gt;= 0 &amp;&amp; i &lt; size;</span></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> s = --size;</span><br><span class="line">    <span class="keyword">if</span> (s == i) <span class="comment">// removed last element</span></span><br><span class="line">        queue[i] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        E moved = (E) queue[s];</span><br><span class="line">        queue[s] = <span class="keyword">null</span>;</span><br><span class="line">        siftDown(i, moved);</span><br><span class="line">        <span class="keyword">if</span> (queue[i] == moved) &#123;</span><br><span class="line">            siftUp(i, moved);</span><br><span class="line">            <span class="keyword">if</span> (queue[i] != moved)</span><br><span class="line">                <span class="keyword">return</span> moved;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Deque-Interface"><a href="#Deque-Interface" class="headerlink" title="Deque Interface"></a>Deque Interface</h2><p><code>Deque</code> stands for <code>Double Ended Queue</code>, which means this is a queue that can be accessed by both ends, and therefore can be used with both <code>FIFO</code> and <code>LIFO</code> styles. By default, it organizes its element <code>LIFO</code> style, meaning that getting the first in the <code>Deque</code> would return the last that had been added.</p>
<p>The <code>Deque</code> interface has the following implementations:</p>
<ul>
<li>LinkedList</li>
<li>ArrayDeque</li>
</ul>
<p>This interface defines methods to access the elements at both ends of the deque. Methods are provided to insert, remove, and examine the element. Each of these methods exists in two forms: one throws an exception if the operation fails, the other returns a special value (either <code>null</code> or <code>false</code>, depending on the operation). The latter form of the insert operation is designed specifically for use with capacity-restricted <code>Deque</code> implementations; in most implementations, insert operations cannot fail.</p>
<p><img src="/2020/12/09/java-collections-queue/deque.png" alt="deque"></p>
<p>This interface extends the <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html"><code>Queue</code></a> interface. When a deque is used as a queue, FIFO (First-In-First-Out) behavior results. Elements are added at the end of the deque and removed from the beginning. The methods inherited from the <code>Queue</code> interface are precisely equivalent to <code>Deque</code> methods as indicated in the following table:</p>
<p><img src="/2020/12/09/java-collections-queue/deque1.png" alt="deque1"></p>
<p>Deques can also be used as LIFO (Last-In-First-Out) stacks. This interface should be used in preference to the legacy <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Stack.html"><code>Stack</code></a> class. When a deque is used as a stack, elements are pushed and popped from the beginning of the deque. Stack methods are precisely equivalent to <code>Deque</code> methods as indicated in the table below:</p>
<p><img src="/2020/12/09/java-collections-queue/deque2.png" alt="deque2"></p>
<hr>
<h3 id="ArrayDeque"><a href="#ArrayDeque" class="headerlink" title="ArrayDeque"></a><code>ArrayDeque</code></h3><p>Resizable-array implementation of the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Deque.html"><code>Deque</code></a> interface. Array deques have no capacity restrictions; they grow as necessary to support usage. They are not thread-safe. Null elements are prohibited.  Most <code>ArrayDeque</code> operations run in <code>amortized</code> constant time.</p>
<ul>
<li> faster than <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Stack.html"><code>Stack</code></a> when used as a stack, and</li>
<li> faster than <a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html"><code>LinkedList</code></a> when used as a queue.</li>
</ul>
<p>Under the hood, <code>ArrayDeque</code> is backed by an array which doubles its size when it gets filled with an initial capacity of 16. Internally, It uses a <code>head</code> and <code>tail</code> as pointer to the index of the first and last elements in the array.</p>
<ul>
<li><strong>head</strong>: the index of the element at the head of queue (which is the element to be removed by <code>remove()</code> and <code>pop()</code> method)</li>
<li><strong>tail</strong>: the index at which the next element would be added to the tail of the queue (via <code>addLast(E)</code>, <code>add(E)</code>, <code>push(E)</code>)</li>
</ul>
<hr>
<h4 id="Use-ArrayDeque-as-Stack"><a href="#Use-ArrayDeque-as-Stack" class="headerlink" title="Use ArrayDeque as Stack"></a>Use <code>ArrayDeque</code> as <code>Stack</code></h4><p><img src="/2020/12/09/java-collections-queue/dequestack.png" alt="dequestack"></p>
<p>Add an element using <code>push(e)</code> and remove the last element using <code>pop()</code></p>
<p>Internally:</p>
<ul>
<li><code>push(e)</code> calls <code>addFirst(e)</code></li>
<li><code>pop()</code> calls <code>removeFirst()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_as_stack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Deque&lt;String&gt; stack = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">    stack.push(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">    stack.push(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">    stack.push(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Initial Stack: &quot;</span> + stack);</span><br><span class="line">    stack.pop();</span><br><span class="line">    System.out.println(<span class="string">&quot;Stack after pop(): &quot;</span> + stack);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent in using addFirst and removeFirst</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_addFirst_removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Deque&lt;String&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">    queue.addFirst(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">    queue.addFirst(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">    queue.addFirst(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Initial queue addFirst(): &quot;</span> + queue);</span><br><span class="line">    queue.removeFirst();</span><br><span class="line">    System.out.println(<span class="string">&quot;queue after removeFirst(): &quot;</span> + queue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Initial Stack: [third, second, first]</span><br><span class="line">Stack after pop(): [second, first]</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="Use-ArrayDeque-as-Queue"><a href="#Use-ArrayDeque-as-Queue" class="headerlink" title="Use ArrayDeque as Queue"></a>Use <code>ArrayDeque</code> as <code>Queue</code></h4><p><img src="/2020/12/09/java-collections-queue/dequequeue.png" alt="dequequeue"></p>
<p>Add an element using <code>offer(e)</code> and remove the first element using <code>poll()</code></p>
<p>Internally:</p>
<ul>
<li><code>offer(e)</code> calls <code>offerLast(e)</code></li>
<li><code>poll()</code> calls <code>pollFirst()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_as_queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Deque&lt;String&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">      queue.offer(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      queue.offer(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">      queue.offer(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;Initial queue: &quot;</span> + queue);</span><br><span class="line">      queue.poll();</span><br><span class="line">      System.out.println(<span class="string">&quot;queue after pop(): &quot;</span> + queue);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent in using addLast and removeFirst</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_addLast_removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Deque&lt;String&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">      queue.addLast(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      queue.addLast(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">      queue.addLast(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;Initial queue addLast(): &quot;</span> + queue);</span><br><span class="line">      queue.removeFirst();</span><br><span class="line">      System.out.println(<span class="string">&quot;queue after removeFirst(): &quot;</span> + queue);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Ouput:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Initial queue: [first, second, third]</span><br><span class="line">queue after pop(): [second, third]</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="Capacity-Expansion"><a href="#Capacity-Expansion" class="headerlink" title="Capacity Expansion"></a>Capacity Expansion</h4><p>Everytime an element is added into the<code>ArrayDeque</code>, it compares the <code>head</code> pointer and the <code>tail</code> pointer. If they are equal, it indicates that the array is full.</p>
<p><img src="/2020/12/09/java-collections-queue/capacity1.png" alt="capacity1"></p>
<p>Then <code>doubleCapacity()</code> will be called:</p>
<p><img src="/2020/12/09/java-collections-queue/capacity2.png" alt="capacity2"></p>
]]></content>
      <categories>
        <category>Java Road Map</category>
      </categories>
      <tags>
        <tag>Java Basics</tag>
        <tag>Collections</tag>
        <tag>Queue</tag>
      </tags>
  </entry>
  <entry>
    <title>Java Map 集合工具类三(Map)</title>
    <url>/2020/12/11/java-collections-map/</url>
    <content><![CDATA[<h2 id="Map-Interface-Overview"><a href="#Map-Interface-Overview" class="headerlink" title="Map Interface Overview"></a>Map Interface Overview</h2><p><img src="/2020/12/11/java-collections-map/overview.jpg" alt="overview"></p>
<p>Java <code>Map</code> interface is one of the most important and most widely used API. A <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html"><code>Map</code></a> is an object that maps keys to values. A map cannot contain duplicate keys: Each key can map to at most one value. </p>
<a id="more"></a>

<hr>
<h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a><code>HashMap</code></h3><p>Java <code>HashMap</code> class implements the <code>Map</code> interface which allows to store key and value pair, where keys should be <strong><em>unique</em></strong>. </p>
<ul>
<li>Java <code>HashMap</code> allows null key and null values</li>
<li>HashMap is not an ordered collection. <code>HashMap.keySet()</code> is not in order of their addition.</li>
<li><code>HashMap</code> is <strong><em>not synchronized</em></strong>.</li>
<li>HashMap stores entries into multiple singly linked lists, called buckets or bins. Default number of bins is <strong><em>16</em></strong> and it’s always in power of 2.</li>
<li>HashMap is <strong><em>not thread safe</em></strong>, <code>ConcurrentHashMap</code> should be used or get synchronized map using <code>Collections.synchronizedMap()</code> method.</li>
</ul>
<hr>
<h4 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h4><p>The architecture of <code>HashMap</code> is as follow:</p>
<ul>
<li>Internally, an array of <code>Node&lt;K,V&gt;</code> class is used to store the data, also known as a <strong>bucket</strong>.</li>
<li><code>Node&lt;K,V&gt;</code> has four attributes:<ul>
<li><code>int hash</code> , <code>K key</code>,  <code>V value</code>, <code>Node&lt;K,V&gt; next</code></li>
</ul>
</li>
<li>Bucket has a <code>LinkedList</code> data structure to store multiple nodes.</li>
<li><code>Array</code> is fast in terms of search with <strong><em>O(1)</em></strong> time, inserting and deleting is slower and has <strong><em>O(n)</em></strong> time. On the onter hand, <code>LinkedList</code> is fast for inserting and deleting while slow for searching. <code>HashMap</code> utilizes the different characteristics of the two data structures to enhance its performance.</li>
</ul>
<p><img src="/2020/12/11/java-collections-map/hashmap.png" alt="hashmap"></p>
<hr>
<h4 id="Initialization"><a href="#Initialization" class="headerlink" title="Initialization"></a>Initialization</h4><p>Upon intitialization, there are two attributes that are important:</p>
<ul>
<li>InitialCapacity:  It specified the initial capacity of the array (number of buckets). By default, it is set to <strong>16</strong>.</li>
<li>loadFactor: It is a measure that decides when to increase the HashMap capacity to maintain the <code>get()</code> and <code>put()</code> operation complexity of <strong><em>O(1)</em></strong>. Be default. it is set to be <strong>0.75f</strong>. When number of buckets filled equals to initial Capacity*loadFactor, the size will be doubled.</li>
</ul>
<p>Constructors:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"># initial capacity 16, load factor 0.75</span><br><span class="line">Map&lt;String, String&gt; map1 = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"># specify initial capacity, load factor 0.75</span><br><span class="line">Map&lt;String, String&gt; map2 = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>^<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"># specify initial capacity and load factor</span><br><span class="line">Map&lt;String, String&gt; map3 = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">32</span>,<span class="number">0.80f</span>);</span><br><span class="line"></span><br><span class="line"># creates a Map having same mappings as the specified map with load </span><br><span class="line"># factor 0.75</span><br><span class="line">Map&lt;String,String&gt; map4 = <span class="keyword">new</span> HashMap&lt;&gt;(map1);</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Hashing-Mechanism"><a href="#Hashing-Mechanism" class="headerlink" title="Hashing Mechanism"></a>Hashing Mechanism</h4><p>Hashing is designed to solve the problem of needing to efficiently find or store an item in a collection. </p>
<ul>
<li><code>HashCode()</code> method : <ul>
<li>It returns the memory reference of the object in integer form. Hash code for <code>null</code> object is <strong>0</strong>.</li>
</ul>
</li>
<li><code>equals()</code> method:<ul>
<li>It checks the equality of two objects. It can be overriden.</li>
<li>If <code>equals()</code> method is overriden, it is mandatory to override the <code>hashCode()</code> method as well.</li>
</ul>
</li>
</ul>
<p>Generally, the <code>hashCode()</code> and <code>equals()</code> method should follow the following rules:</p>
<ol>
<li>If <code>obj1.equals(obj2)</code>, then <code>obj1.hashCode()==obj2.hashCode()</code> should always be true.</li>
<li>If <code>obj1.hashCode()==obj2.hashCode()</code> is true, <code>obj1.equals(obj2)</code> does not have to be true.</li>
</ol>
<hr>
<p>In <code>HashMap</code>, the hashing mechanism works in two steps:</p>
<ul>
<li>When an entry is added into the HashMap, it computes the hashcode on the key of the entry using <code>hashCode()</code>. ==&gt; <strong><em>first hash</em></strong></li>
<li>The bitwise XOR operator is then used to spread the higher bits to  lowers. ==&gt; <strong><em>second hash</em></strong></li>
</ul>
<p>The implementations:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Based on the hash code computed, the index of the bucket for the enrty to be put into is then calculated:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">index = (n-<span class="number">1</span>) &amp; hash <span class="comment">// n is the size of the bucket</span></span><br></pre></td></tr></table></figure>

<p>A <strong>Hash Collision</strong> is a situation where <strong>two or more key objects produce the same final hash value</strong> and hence point to the same bucket location or array index. This scenario can occur because according to the <em>equals</em> and <em>hashCode</em> contract, <strong>two unequal objects in Java can have the same hash code</strong>. It can also happen because of the finite size of the underlying array, that is, before resizing. The smaller this array, the higher the chances of collision.</p>
<hr>
<h4 id="HashMap-put-K-V-Method"><a href="#HashMap-put-K-V-Method" class="headerlink" title="HashMap put( K, V ) Method"></a>HashMap put( K, V ) Method</h4><p>The flow chart below demonstrates the execution logic of <code>put</code> method:</p>
<p><img src="/2020/12/11/java-collections-map/hashmap2.png" alt="hashmap"></p>
<p>Source code for JDK1.8 HashMap:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">// If table is empty or length == 0</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// Calculate hash value and put in the entry</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// If key already exists, replace the value</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// If the bin is a red black tree</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          	<span class="comment">// If the bin is a linkedlist</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                  	<span class="comment">// If linkedlist length greater than 8, treeify</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Key already exists, replace the value</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// resize if the size greater than threshold capacity</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<hr>
<h4 id="HashMap-get-Object-key-Method"><a href="#HashMap-get-Object-key-Method" class="headerlink" title="HashMap get(Object key) Method"></a>HashMap get(Object key) Method</h4><p>The get method is straightforward, based on the hash code computed for the input key, it finds the bucket corresponds to the hash value and iterate through all the map entries stored there. <strong><em>equals()</em></strong> is used to compare the key and if no such key available, <code>null</code> is returned.</p>
<p>Source code for JDK1.8 HashMap:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// create a HashMap instance</span></span><br><span class="line">    HashMap&lt;String, String&gt; hm = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    <span class="comment">// put entries into the HashMap</span></span><br><span class="line">    hm.put(<span class="string">&quot;Canada&quot;</span>, <span class="string">&quot;Montreal&quot;</span>);</span><br><span class="line">    hm.put(<span class="string">&quot;America&quot;</span>, <span class="string">&quot;New York&quot;</span>);</span><br><span class="line">    hm.put(<span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;Soul&quot;</span>);</span><br><span class="line">    hm.put(<span class="string">&quot;China&quot;</span>, <span class="string">&quot;Shanghai&quot;</span>);</span><br><span class="line">    hm.put(<span class="string">&quot;China&quot;</span>, <span class="string">&quot;Beijing&quot;</span>); <span class="comment">// duplicated key</span></span><br><span class="line">    System.out.println(hm);</span><br><span class="line">    System.out.println(hm.get(<span class="string">&quot;China&quot;</span>)); <span class="comment">// get the value for a key</span></span><br><span class="line">    <span class="comment">// iterate through the HashMap key set</span></span><br><span class="line">    <span class="keyword">for</span>(String s: hm.keySet()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;key: &quot;</span> + s + <span class="string">&quot;; value: &quot;</span> + hm.get(s));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// iterate through the HashMap values</span></span><br><span class="line">    <span class="keyword">for</span> (String value: hm.values()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;value: &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;China&#x3D;Beijing, Korea&#x3D;Soul, Canada&#x3D;Montreal, America&#x3D;New York&#125;</span><br><span class="line">Beijing</span><br><span class="line">key: China; value: Beijing</span><br><span class="line">key: Korea; value: Soul</span><br><span class="line">key: Canada; value: Montreal</span><br><span class="line">key: America; value: New York</span><br><span class="line">value: Beijing</span><br><span class="line">value: Soul</span><br><span class="line">value: Montreal</span><br><span class="line">value: New York</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a><code>HashTable</code></h3><p>The <code>HashTable</code> class implements a hash table, which maps keys to values. Any non-null object can be used as a key or as a value. To successfully store and retrieve objects from a <code>HashTable</code>, the objects used as keys must implement the <code>hashCode()</code> method and <code>equals()</code> method. Generally, <code>HashTable</code> is vert similar to <code>HashMap</code> except for the following differenes:</p>
<ul>
<li><code>HashTable</code> is <strong><em>synchronized</em></strong></li>
<li>The initial capacity of <code>HashTable</code> class is <strong><em>11</em></strong>, whereas loadFactor is <strong><em>0.75</em></strong></li>
<li><code>HashTable</code> implements <code>Serializable</code>, <code>Cloneable</code>, <code>Map&lt;K,V&gt;</code> interface as well as <code>Dictionary&lt;K,V&gt;</code></li>
</ul>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Hashtable&lt;String, String&gt; ht = <span class="keyword">new</span> Hashtable&lt;String, String&gt;();</span><br><span class="line">    ht.put(<span class="string">&quot;Canada&quot;</span>, <span class="string">&quot;Montreal&quot;</span>);</span><br><span class="line">    ht.put(<span class="string">&quot;America&quot;</span>, <span class="string">&quot;New York&quot;</span>);</span><br><span class="line">    ht.put(<span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;Soul&quot;</span>);</span><br><span class="line">    ht.put(<span class="string">&quot;China&quot;</span>, <span class="string">&quot;Shanghai&quot;</span>);</span><br><span class="line">    ht.put(<span class="string">&quot;China&quot;</span>, <span class="string">&quot;Beijing&quot;</span>); <span class="comment">// duplicated key</span></span><br><span class="line">    System.out.println(ht);</span><br><span class="line">    System.out.println(ht.get(<span class="string">&quot;China&quot;</span>)); <span class="comment">// get the value for a key</span></span><br><span class="line">    <span class="comment">// iterate through the HashMap key set</span></span><br><span class="line">    <span class="keyword">for</span>(String s: ht.keySet()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;key: &quot;</span> + s + <span class="string">&quot;; value: &quot;</span> + ht.get(s));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// iterate through the HashMap values</span></span><br><span class="line">    <span class="keyword">for</span> (String value: ht.values()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;value: &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;China&#x3D;Beijing, Korea&#x3D;Soul, Canada&#x3D;Montreal, America&#x3D;New York&#125;</span><br><span class="line">Beijing</span><br><span class="line">key: China; value: Beijing</span><br><span class="line">key: Korea; value: Soul</span><br><span class="line">key: Canada; value: Montreal</span><br><span class="line">key: America; value: New York</span><br><span class="line">value: Beijing</span><br><span class="line">value: Soul</span><br><span class="line">value: Montreal</span><br><span class="line">value: New York</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="HashTable-Usage"><a href="#HashTable-Usage" class="headerlink" title="HashTable Usage"></a>HashTable Usage</h4><p>Java <code>HashTable</code> has been considered to be deprecated, and in fact, most of the synchronized collections have been deprecated. Synchronization has a cost and using synchronized collection in places where there is no need of it leads to useless utilization of resources. Under multi-threaded environment, Java <code>ConcurrentHashMap</code> is a good alternative which provides better performance than <code>HashTable</code>. </p>
<hr>
<h3 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a><code>LinkedHashMap</code></h3><p>The <code>LinkedHashMap</code> is just like <a href="http://www.geeksforgeeks.org/java-util-hashmap-in-java/">HashMap</a> with an additional feature of maintaining an order of elements inserted into it. HashMap provided the advantage of quick insertion, search, and deletion but it never maintained the track and order of insertion which the LinkedHashMap provides where the elements can be <strong>accessed in their insertion order</strong>.</p>
<p>Important features of <code>LinkedHahsMap</code>:</p>
<ul>
<li> <code>LinkedList</code> implements <code>Map</code> interface and extends the <code>HashMap</code> class</li>
<li>It allows only unique elements</li>
<li>It allows one <code>null</code> key and multiple <code>null</code> values</li>
<li>It is <strong><em>not synchronized</em></strong></li>
<li>It is provides additional functionalities of maintaining insertion order of elements</li>
</ul>
<hr>
<h4 id="Map-Entries"><a href="#Map-Entries" class="headerlink" title="Map Entries"></a>Map Entries</h4><p>To maintain the order of elements, the linked hashmap modifies the <em>Map.Entry</em> class of <em>HashMap</em> by adding pointers to the next and previous entries:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; before, after;</span><br><span class="line">    Entry(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Two pointers: <strong><em>head</em></strong> and <strong><em>tail</em></strong> are added which enables itself to hook to the linked list. </p>
<hr>
<h4 id="Architecture-1"><a href="#Architecture-1" class="headerlink" title="Architecture"></a>Architecture</h4><ol>
<li>If <code>accessOrder == false</code>, it will result in insertion order. </li>
</ol>
<p>The architecture is similar to that of HashMap:</p>
<p><img src="/2020/12/11/java-collections-map/linkedhashmap1.png" alt="linkedhashmap1"></p>
<p>The above diagram shows the structure of the LinkedHashMap when <code>accessOrder = false</code> which is the default setting. The insertion order is maintained through the doubly linkedlist. When a <code>put(K,V)</code> is called, the entry is put to the tail of the linkedlist. </p>
<hr>
<ol start="2">
<li>If <code>accessOrder == true</code>, the it will result in access order. One of the important application of access order LinkedHashMap is building <strong><em>LRU</em></strong> cache. </li>
</ol>
<p><img src="/2020/12/11/java-collections-map/linkedhashmap2.png" alt="linkedhashmap2"></p>
<p>The above diagram shows the structure of the LinkedHashMap when <code>accessOrder = true</code>. The doubly linkedlists of the nodes preserve the order by which they are accessed. The least recently accessed element will become the head, while the most recently accessed element becomes the tail. </p>
<blockquote>
<p>A structural modification is any operation that adds or deletes one or more mappings or, in the case of access-ordered linked hash maps, affects iteration order.  In insertion-ordered linked hash maps, merely changing the value associated with a key that is already contained in the map is not a structural modification.  In access-ordered linked hash maps, merely querying the map with <tt>get</tt> is a structural modification.</p>
</blockquote>
<hr>
<p><code>LinkedHashMap</code> class overridestes multiple functions that helps it to maintain the doubly linked list as well as preserve the insertion or access order. Below is an overview of the execution flow:</p>
<p><img src="/2020/12/11/java-collections-map/linkedhashmap3.png" alt="linkedhashmap3"></p>
<p>The implementation of the specific functionalities will be discussed in the following subsections.</p>
<hr>
<h4 id="LinkedHashMap-put-K-V-Method"><a href="#LinkedHashMap-put-K-V-Method" class="headerlink" title="LinkedHashMap.put( K, V ) Method"></a>LinkedHashMap.put( K, V ) Method</h4><p><code>LinkedHashMap</code> reuses the <code>put</code> implementation from <code>HashMap</code> class. Everytime a new node is created and put into the bucket, <code>newNode(hash, key, value, next)</code> is called. However, the original method implementation could not perform operations related to the doubly linked list. Hence, <code>LinkedHashMap</code> class overridestes the <code>newNode</code> method: </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// Overriden by LinkedHashmap</span></span><br><span class="line"><span class="function">Node&lt;K,V&gt; <span class="title">newNode</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; e)</span> </span>&#123;</span><br><span class="line">      LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">          <span class="keyword">new</span> LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e);</span><br><span class="line">      linkNodeLast(p);</span><br><span class="line">      <span class="keyword">return</span> p;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>The <code>linkNodeLast</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// Implemented by LinkedHashmap</span></span><br><span class="line"><span class="comment">// link at the end of list</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">linkNodeLast</span><span class="params">(LinkedHashMap.Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">      LinkedHashMap.Entry&lt;K,V&gt; last = tail;</span><br><span class="line">      tail = p;</span><br><span class="line">      <span class="keyword">if</span> (last == <span class="keyword">null</span>)</span><br><span class="line">          head = p;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          p.before = last;</span><br><span class="line">          last.after = p;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="LinkedHashMap-get-K-V-Method"><a href="#LinkedHashMap-get-K-V-Method" class="headerlink" title="LinkedHashMap.get( K, V ) Method"></a>LinkedHashMap.get( K, V ) Method</h4><p>The <code>LinkedHashMap</code> overrides the <code>afterNodeAccess</code> method. By default, the linkedhashmap maintain the order of the elements by the order of insertion. If <code>accessOrder</code> is specified to be <code>true</code> during initialization, the order will be preserved by the access order. This can be easily done by moving the node to the tail of the doubly linked list when <code>get</code> or <code>getOrDefault</code> or <code>replace</code> methods are invoked. <code>afterNodeAccess</code> method overriden by <code>LinkedHashMap</code> provides such functionality:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// Overriden by LinkedHashMap</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">      Node&lt;K,V&gt; e;</span><br><span class="line">      <span class="keyword">if</span> ((e = getNode(hash(key), key)) == <span class="keyword">null</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">if</span> (accessOrder)</span><br><span class="line">          afterNodeAccess(e);</span><br><span class="line">      <span class="keyword">return</span> e.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Overriden by LinkedHashMap</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; e)</span> </span>&#123; <span class="comment">// move node to last</span></span><br><span class="line">      LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">      <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">          LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">              (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">          p.after = <span class="keyword">null</span>;</span><br><span class="line">          <span class="keyword">if</span> (b == <span class="keyword">null</span>)</span><br><span class="line">              head = a;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">              b.after = a;</span><br><span class="line">          <span class="keyword">if</span> (a != <span class="keyword">null</span>)</span><br><span class="line">              a.before = b;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">              last = b;</span><br><span class="line">          <span class="keyword">if</span> (last == <span class="keyword">null</span>)</span><br><span class="line">              head = p;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              p.before = last;</span><br><span class="line">              last.after = p;</span><br><span class="line">          &#125;</span><br><span class="line">          tail = p;</span><br><span class="line">          ++modCount;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="LinkedHashMap-remove-K-Method"><a href="#LinkedHashMap-remove-K-Method" class="headerlink" title="LinkedHashMap.remove (K) Method"></a>LinkedHashMap.remove (K) Method</h4><p>The <code>LinkedHashMap</code> class reuses the <code>HashMap</code>‘s implementation for the removing the entries. However, in order to remove the entry from the doubly linked list, additional efforts has to be made as the parent class implementation could not do that. Hence, the hook method <code>afterRemoval</code> is overriden for this purpose. The <code>remove</code> and <code>removeNode</code> implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Implemented by HashMap</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>)) == <span class="keyword">null</span> ?</span><br><span class="line">        <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Implemented by HashMap</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,<span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                node = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// iterate through the list</span></span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                            ((k = e.key) == key ||</span><br><span class="line">                             (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                            node = e;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        p = e;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                                 (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">                <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</span><br><span class="line">                <span class="comment">// remove the entry</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                    tab[index] = node.next;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    p.next = node.next;</span><br><span class="line">                ++modCount;</span><br><span class="line">                --size;</span><br><span class="line">                <span class="comment">// hook method to be called</span></span><br><span class="line">                afterNodeRemoval(node);</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>afterNodeRemoval</code> implementation:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Overriden by LinkedHashMap</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeRemoval</span><span class="params">(Node&lt;K,V&gt; e)</span> </span>&#123; <span class="comment">// unlink</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">        (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">    p.before = p.after = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="keyword">null</span>)</span><br><span class="line">        head = a;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        b.after = a;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="keyword">null</span>)</span><br><span class="line">        tail = b;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        a.before = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="LRU-Cache-Implementation-Using-LinkedHashMap"><a href="#LRU-Cache-Implementation-Using-LinkedHashMap" class="headerlink" title="LRU Cache Implementation Using LinkedHashMap"></a>LRU Cache Implementation Using LinkedHashMap</h4><p>Before looking at the <strong><em>Least Recently Used cache</em></strong>  problem, the LinkedHashMap overrides the <code>afterNodeInsertion</code> method which possibly removes eldest node from the list:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">// Overriden by LinkedHashMap</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeInsertion</span><span class="params">(<span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">      LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class="line">      <span class="keyword">if</span> (evict &amp;&amp; (first = head) != <span class="keyword">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class="line">          K key = first.key;</span><br><span class="line">          removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// do nothing, always return false</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry&lt;K,V&gt; eldest)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>After the <code>put</code> method is called, it invokes <code>afterNodeInsertion</code> method. By default, <code>afterNodeInsertion</code> does nothing as <code>removeEldestEntry</code> always return <code>false</code>. </p>
<blockquote>
<p>This method typically does not modify the map in any way, instead allowing the map to modify itself as directed by its return value. It is permitted for this method to modify the map directly, but if it does so, it must return false. </p>
</blockquote>
<p>Hence, the <code>removeEldestEntry (Map.Entry)</code> method may be overriden to impose a policy for removing stale mapping automatically when new mappings are added to the map. This is the key to implement a LRU cache using LinkedHashMap.</p>
<p>The problem description of the <strong><em>Least Recently Used cache</em></strong> problem can be found on <a href="https://leetcode.com/problems/lru-cache/solution/">leetcode</a>. </p>
<p>The implementation is as following:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span> <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">Integer</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRUCache</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(capacity, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getOrDefault(key, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry&lt;Integer, Integer&gt; eldest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() &gt; capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LRUCache cache = <span class="keyword">new</span> LRUCache(<span class="number">2</span>);</span><br><span class="line">        cache.put(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        cache.put(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">        cache.put(<span class="number">3</span>,<span class="number">3</span>);</span><br><span class="line">        cache.put(<span class="number">4</span>,<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">for</span> (Integer value: cache.values()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;value: &quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ouput:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">value: 3</span><br><span class="line">value: 4</span><br></pre></td></tr></table></figure>

<p>In the above implementation, when <code>size() &gt; capacity</code>, the <code>removeEldest</code> method will return true and as a result, the eldest node (head) will be removed. </p>
]]></content>
      <categories>
        <category>Java Road Map</category>
      </categories>
      <tags>
        <tag>Java Basics</tag>
        <tag>Collections</tag>
        <tag>Map</tag>
      </tags>
  </entry>
</search>
