<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Queue Interface Overview Queue is a collection designed for holding elements prior to processing. Besides basic Collection operations, queues provide additional insertion, extraction, and inspection o">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Collections.Queue 集合工具类二(Queue)">
<meta property="og:url" content="http://example.com/2020/12/09/java-collections-queue/index.html">
<meta property="og:site_name" content="Wzxiaa&#39;s Blog">
<meta property="og:description" content="Queue Interface Overview Queue is a collection designed for holding elements prior to processing. Besides basic Collection operations, queues provide additional insertion, extraction, and inspection o">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/overview.jpg">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/priorityqueue.jpg">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/insert.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/remove.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/removeat.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/deque.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/deque1.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/deque2.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/dequestack.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/dequequeue.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/capacity1.png">
<meta property="og:image" content="http://example.com/2020/12/09/java-collections-queue/capacity2.png">
<meta property="article:published_time" content="2020-12-09T19:56:41.000Z">
<meta property="article:modified_time" content="2020-12-21T06:42:33.755Z">
<meta property="article:author" content="Wzxiaa">
<meta property="article:tag" content="Java Basics">
<meta property="article:tag" content="Collections">
<meta property="article:tag" content="Queue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2020/12/09/java-collections-queue/overview.jpg">

<link rel="canonical" href="http://example.com/2020/12/09/java-collections-queue/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Java Collections.Queue 集合工具类二(Queue) | Wzxiaa's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KECC7YCGRF"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-KECC7YCGRF');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Wzxiaa's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">An Artificially Intelligent Software Engineer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/wzxiaa" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/09/java-collections-queue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="Wzxiaa">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wzxiaa's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java Collections.Queue 集合工具类二(Queue)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-09 14:56:41" itemprop="dateCreated datePublished" datetime="2020-12-09T14:56:41-05:00">2020-12-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-21 01:42:33" itemprop="dateModified" datetime="2020-12-21T01:42:33-05:00">2020-12-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-Road-Map/" itemprop="url" rel="index"><span itemprop="name">Java Road Map</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="firestore-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>8.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>8 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Queue-Interface-Overview"><a href="#Queue-Interface-Overview" class="headerlink" title="Queue Interface Overview"></a>Queue Interface Overview</h2><p><img src="/2020/12/09/java-collections-queue/overview.jpg" alt="overview"></p>
<p><code>Queue</code> is a collection designed for holding elements prior to processing. Besides basic <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html"><code>Collection</code></a> operations, queues provide additional insertion, extraction, and inspection operations. Each of these methods exists in two forms: </p>
<a id="more"></a>

<ul>
<li>one throws an exception if the operation fails</li>
<li>the other returns a special value (either <code>null</code> or <code>false</code>, depending on the operation). </li>
</ul>
<p>The latter form of the insert operation is designed specifically for use with capacity-restricted <code>Queue</code> implementations; in most implementations, insert operations cannot fail.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">throws Exception</th>
<th align="center">Returns special value</th>
</tr>
</thead>
<tbody><tr>
<td align="center">insert</td>
<td align="center">add(e)</td>
<td align="center">offer(e)</td>
</tr>
<tr>
<td align="center">remove</td>
<td align="center">remove()</td>
<td align="center">poll()</td>
</tr>
<tr>
<td align="center">examine</td>
<td align="center">element()</td>
<td align="center">peek()</td>
</tr>
</tbody></table>
<hr>
<h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a><code>PriorityQueue</code></h3><h4 id="Basic-Concept"><a href="#Basic-Concept" class="headerlink" title="Basic Concept"></a>Basic Concept</h4><p>A priority queue is an Abstract Data Type that operates similar to a normal queue except that <strong><em>each element has a certain priority</em></strong>. The priority of the element in the priority queue determine the order in which elements are removed from the PQ.</p>
<p>The most common implementation of a PQ is using <code>binary heap</code> (二叉小顶堆).</p>
<p><img src="/2020/12/09/java-collections-queue/priorityqueue.jpg" alt="overview"></p>
<p>Indexing:</p>
<ul>
<li>Parent node index : i</li>
<li>Left child node index : 2i</li>
<li>Right child node index : 2i + 1</li>
<li>Parent node = ( node_index - 1 )  / 2 </li>
</ul>
<hr>
<p><strong>Strength</strong>:</p>
<ul>
<li>Quickly access the highest-priority item. Peek at the top item in <strong><em>O(1)</em></strong> while keeping other operations relatively cheap <strong><em>O(log(n))</em></strong>.</li>
</ul>
<p><strong>Weakness</strong>:</p>
<ul>
<li>Slow enqueues and dequeues. Both operations take <strong><em>O(log(n))</em></strong> time with priority queues. With normal FIFO queues, the operations are <strong><em>O(1)</em></strong> time.</li>
</ul>
<hr>
<h4 id="Java-API"><a href="#Java-API" class="headerlink" title="Java API"></a>Java API</h4><p>A <code>PriorityQueue</code> is used when the objects are supposed to be processed based on the priority. It is known that a <a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/queue-interface-java/">Queue</a> follows the <code>First-In-First-Out</code> algorithm. The PriorityQueue is based on the priority heap. The elements of the priority queue are ordered according to the natural ordering, or by a Comparator provided at queue construction time, depending on which constructor is used. It implements <code>Serializable</code>, <code>Iterable&lt;E&gt;</code>, <code>Collection&lt;E&gt;</code>,  <code> Queue</code> interfaces.</p>
<p>Characteristics:</p>
<ul>
<li>Does not permit <code>null</code></li>
<li>Can’t create PriorityQueue of objects that are non-comparable</li>
<li>PriorityQueue are unbounded queues</li>
<li>Not thread-safe, use <code>PriorityBlockingQueue</code> class for multi-threading</li>
<li><strong><em>O(log(n))</em></strong> for <code>add</code> and <code>poll</code></li>
</ul>
<hr>
<h5 id="Insert-Element-and-ShiftUp"><a href="#Insert-Element-and-ShiftUp" class="headerlink" title="Insert Element and ShiftUp"></a>Insert Element and ShiftUp</h5><p><code>add(e)</code> and <code>offer(e)</code> are equivalent except for the exception handling. add(e) throws exception while offer(e) returns null.</p>
<p><img src="/2020/12/09/java-collections-queue/insert.png" alt="insert"></p>
<p><code>Offer(e)</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> i = size;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= queue.length)</span><br><span class="line">        grow(i + <span class="number">1</span>);</span><br><span class="line">    size = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        queue[<span class="number">0</span>] = e;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftUp(i, e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>siftUp(i, e)</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">        siftUpUsingComparator(k, x);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftUpComparable(k, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUpComparable</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    Comparable&lt;? <span class="keyword">super</span> E&gt; key = (Comparable&lt;? <span class="keyword">super</span> E&gt;) x;</span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> parent = (k - <span class="number">1</span>) &gt;&gt;&gt; <span class="number">1</span>; <span class="comment">// parent node = (node-1)/2</span></span><br><span class="line">        Object e = queue[parent];</span><br><span class="line">        <span class="keyword">if</span> (key.compareTo((E) e) &gt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        queue[k] = e;</span><br><span class="line">        k = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[k] = key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Peek-Element"><a href="#Peek-Element" class="headerlink" title="Peek/Element"></a>Peek/Element</h5><p><code>peek()</code> and <code>element()</code> are equivalent except for the exception handling. <code>peek()</code> returns <code>null</code> while <code>element()</code> throws exception.</p>
<p>peek() implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (size == <span class="number">0</span>) ? <span class="keyword">null</span> : (E) queue[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Remove-head-element"><a href="#Remove-head-element" class="headerlink" title="Remove head element"></a>Remove head element</h5><p><code>poll()</code> and <code>remove()</code> are equivalent except for the exception handling. <code>remove()</code> returns <code>null</code> while <code>poll()</code> throws exception.</p>
<p><img src="/2020/12/09/java-collections-queue/remove.png" alt="remove"></p>
<p><code>poll()</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> s = --size;</span><br><span class="line">    modCount++;</span><br><span class="line">    E result = (E) queue[<span class="number">0</span>];</span><br><span class="line">    E x = (E) queue[s];</span><br><span class="line">    queue[s] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="number">0</span>)</span><br><span class="line">        siftDown(<span class="number">0</span>, x);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>shiftDown(i, e)</code> method implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (comparator != <span class="keyword">null</span>)</span><br><span class="line">        siftDownUsingComparator(k, x);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftDownComparable(k, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDownComparable</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    Comparable&lt;? <span class="keyword">super</span> E&gt; key = (Comparable&lt;? <span class="keyword">super</span> E&gt;)x;</span><br><span class="line">    <span class="keyword">int</span> half = size &gt;&gt;&gt; <span class="number">1</span>;        <span class="comment">// loop while a non-leaf</span></span><br><span class="line">    <span class="keyword">while</span> (k &lt; half) &#123;</span><br><span class="line">        <span class="keyword">int</span> child = (k &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>; <span class="comment">// assume left child is least</span></span><br><span class="line">        Object c = queue[child];</span><br><span class="line">        <span class="keyword">int</span> right = child + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp;</span><br><span class="line">            ((Comparable&lt;? <span class="keyword">super</span> E&gt;) c).compareTo((E) queue[right]) &gt; <span class="number">0</span>)</span><br><span class="line">            c = queue[child = right];</span><br><span class="line">        <span class="keyword">if</span> (key.compareTo((E) c) &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        queue[k] = c;</span><br><span class="line">        k = child;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[k] = key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Remove-specific-element"><a href="#Remove-specific-element" class="headerlink" title="Remove specific element"></a>Remove specific element</h5><p>There are two scenarios:</p>
<ul>
<li><p>The element to be removed is the last element:</p>
<ul>
<li>Delete immediately without modifying the queue structure</li>
</ul>
</li>
<li><p>The element is at somewhere else:</p>
<ul>
<li>Apply shiftDown from the element to be removed with the last element in the queue.</li>
</ul>
</li>
</ul>
<p><img src="/2020/12/09/java-collections-queue/removeat.png" alt="removeat"></p>
<p><code>remove(o)</code> implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = indexOf(o);</span><br><span class="line">    <span class="keyword">if</span> (i == -<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        removeAt(i);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">removeAt</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert i &gt;= 0 &amp;&amp; i &lt; size;</span></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> s = --size;</span><br><span class="line">    <span class="keyword">if</span> (s == i) <span class="comment">// removed last element</span></span><br><span class="line">        queue[i] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        E moved = (E) queue[s];</span><br><span class="line">        queue[s] = <span class="keyword">null</span>;</span><br><span class="line">        siftDown(i, moved);</span><br><span class="line">        <span class="keyword">if</span> (queue[i] == moved) &#123;</span><br><span class="line">            siftUp(i, moved);</span><br><span class="line">            <span class="keyword">if</span> (queue[i] != moved)</span><br><span class="line">                <span class="keyword">return</span> moved;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Deque-Interface"><a href="#Deque-Interface" class="headerlink" title="Deque Interface"></a>Deque Interface</h2><p><code>Deque</code> stands for <code>Double Ended Queue</code>, which means this is a queue that can be accessed by both ends, and therefore can be used with both <code>FIFO</code> and <code>LIFO</code> styles. By default, it organizes its element <code>LIFO</code> style, meaning that getting the first in the <code>Deque</code> would return the last that had been added.</p>
<p>The <code>Deque</code> interface has the following implementations:</p>
<ul>
<li>LinkedList</li>
<li>ArrayDeque</li>
</ul>
<p>This interface defines methods to access the elements at both ends of the deque. Methods are provided to insert, remove, and examine the element. Each of these methods exists in two forms: one throws an exception if the operation fails, the other returns a special value (either <code>null</code> or <code>false</code>, depending on the operation). The latter form of the insert operation is designed specifically for use with capacity-restricted <code>Deque</code> implementations; in most implementations, insert operations cannot fail.</p>
<p><img src="/2020/12/09/java-collections-queue/deque.png" alt="deque"></p>
<p>This interface extends the <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html"><code>Queue</code></a> interface. When a deque is used as a queue, FIFO (First-In-First-Out) behavior results. Elements are added at the end of the deque and removed from the beginning. The methods inherited from the <code>Queue</code> interface are precisely equivalent to <code>Deque</code> methods as indicated in the following table:</p>
<p><img src="/2020/12/09/java-collections-queue/deque1.png" alt="deque1"></p>
<p>Deques can also be used as LIFO (Last-In-First-Out) stacks. This interface should be used in preference to the legacy <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/api/java/util/Stack.html"><code>Stack</code></a> class. When a deque is used as a stack, elements are pushed and popped from the beginning of the deque. Stack methods are precisely equivalent to <code>Deque</code> methods as indicated in the table below:</p>
<p><img src="/2020/12/09/java-collections-queue/deque2.png" alt="deque2"></p>
<hr>
<h3 id="ArrayDeque"><a href="#ArrayDeque" class="headerlink" title="ArrayDeque"></a><code>ArrayDeque</code></h3><p>Resizable-array implementation of the <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/Deque.html"><code>Deque</code></a> interface. Array deques have no capacity restrictions; they grow as necessary to support usage. They are not thread-safe. Null elements are prohibited.  Most <code>ArrayDeque</code> operations run in <code>amortized</code> constant time.</p>
<ul>
<li> faster than <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/Stack.html"><code>Stack</code></a> when used as a stack, and</li>
<li> faster than <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedList.html"><code>LinkedList</code></a> when used as a queue.</li>
</ul>
<p>Under the hood, <code>ArrayDeque</code> is backed by an array which doubles its size when it gets filled with an initial capacity of 16. Internally, It uses a <code>head</code> and <code>tail</code> as pointer to the index of the first and last elements in the array.</p>
<ul>
<li><strong>head</strong>: the index of the element at the head of queue (which is the element to be removed by <code>remove()</code> and <code>pop()</code> method)</li>
<li><strong>tail</strong>: the index at which the next element would be added to the tail of the queue (via <code>addLast(E)</code>, <code>add(E)</code>, <code>push(E)</code>)</li>
</ul>
<hr>
<h4 id="Use-ArrayDeque-as-Stack"><a href="#Use-ArrayDeque-as-Stack" class="headerlink" title="Use ArrayDeque as Stack"></a>Use <code>ArrayDeque</code> as <code>Stack</code></h4><p><img src="/2020/12/09/java-collections-queue/dequestack.png" alt="dequestack"></p>
<p>Add an element using <code>push(e)</code> and remove the last element using <code>pop()</code></p>
<p>Internally:</p>
<ul>
<li><code>push(e)</code> calls <code>addFirst(e)</code></li>
<li><code>pop()</code> calls <code>removeFirst()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_as_stack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Deque&lt;String&gt; stack = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">    stack.push(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">    stack.push(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">    stack.push(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Initial Stack: &quot;</span> + stack);</span><br><span class="line">    stack.pop();</span><br><span class="line">    System.out.println(<span class="string">&quot;Stack after pop(): &quot;</span> + stack);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent in using addFirst and removeFirst</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_addFirst_removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Deque&lt;String&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">    queue.addFirst(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">    queue.addFirst(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">    queue.addFirst(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Initial queue addFirst(): &quot;</span> + queue);</span><br><span class="line">    queue.removeFirst();</span><br><span class="line">    System.out.println(<span class="string">&quot;queue after removeFirst(): &quot;</span> + queue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Initial Stack: [third, second, first]</span><br><span class="line">Stack after pop(): [second, first]</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="Use-ArrayDeque-as-Queue"><a href="#Use-ArrayDeque-as-Queue" class="headerlink" title="Use ArrayDeque as Queue"></a>Use <code>ArrayDeque</code> as <code>Queue</code></h4><p><img src="/2020/12/09/java-collections-queue/dequequeue.png" alt="dequequeue"></p>
<p>Add an element using <code>offer(e)</code> and remove the first element using <code>poll()</code></p>
<p>Internally:</p>
<ul>
<li><code>offer(e)</code> calls <code>offerLast(e)</code></li>
<li><code>poll()</code> calls <code>pollFirst()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_as_queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Deque&lt;String&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">      queue.offer(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      queue.offer(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">      queue.offer(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;Initial queue: &quot;</span> + queue);</span><br><span class="line">      queue.poll();</span><br><span class="line">      System.out.println(<span class="string">&quot;queue after pop(): &quot;</span> + queue);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent in using addLast and removeFirst</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">arraydeque_addLast_removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Deque&lt;String&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">      queue.addLast(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">      queue.addLast(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">      queue.addLast(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line">      System.out.println(<span class="string">&quot;Initial queue addLast(): &quot;</span> + queue);</span><br><span class="line">      queue.removeFirst();</span><br><span class="line">      System.out.println(<span class="string">&quot;queue after removeFirst(): &quot;</span> + queue);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Ouput:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Initial queue: [first, second, third]</span><br><span class="line">queue after pop(): [second, third]</span><br></pre></td></tr></table></figure>



<hr>
<h4 id="Capacity-Expansion"><a href="#Capacity-Expansion" class="headerlink" title="Capacity Expansion"></a>Capacity Expansion</h4><p>Everytime an element is added into the<code>ArrayDeque</code>, it compares the <code>head</code> pointer and the <code>tail</code> pointer. If they are equal, it indicates that the array is full.</p>
<p><img src="/2020/12/09/java-collections-queue/capacity1.png" alt="capacity1"></p>
<p>Then <code>doubleCapacity()</code> will be called:</p>
<p><img src="/2020/12/09/java-collections-queue/capacity2.png" alt="capacity2"></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java-Basics/" rel="tag"># Java Basics</a>
              <a href="/tags/Collections/" rel="tag"># Collections</a>
              <a href="/tags/Queue/" rel="tag"># Queue</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/12/09/hello-world/" rel="prev" title="Build Blog with Hexo + Github + NexT">
      <i class="fa fa-chevron-left"></i> Build Blog with Hexo + Github + NexT
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/09/java-collections-list/" rel="next" title="Java Collections.List 集合工具类一(List)">
      Java Collections.List 集合工具类一(List) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Queue-Interface-Overview"><span class="nav-number">1.</span> <span class="nav-text">Queue Interface Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PriorityQueue"><span class="nav-number">1.1.</span> <span class="nav-text">PriorityQueue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Basic-Concept"><span class="nav-number">1.1.1.</span> <span class="nav-text">Basic Concept</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Java-API"><span class="nav-number">1.1.2.</span> <span class="nav-text">Java API</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Insert-Element-and-ShiftUp"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Insert Element and ShiftUp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Peek-Element"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Peek&#x2F;Element</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-head-element"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">Remove head element</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-specific-element"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">Remove specific element</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deque-Interface"><span class="nav-number">2.</span> <span class="nav-text">Deque Interface</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ArrayDeque"><span class="nav-number">2.1.</span> <span class="nav-text">ArrayDeque</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-ArrayDeque-as-Stack"><span class="nav-number">2.1.1.</span> <span class="nav-text">Use ArrayDeque as Stack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Use-ArrayDeque-as-Queue"><span class="nav-number">2.1.2.</span> <span class="nav-text">Use ArrayDeque as Queue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Capacity-Expansion"><span class="nav-number">2.1.3.</span> <span class="nav-text">Capacity Expansion</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wzxiaa"
      src="/images/avatar.JPG">
  <p class="site-author-name" itemprop="name">Wzxiaa</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wzxiaa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wzxiaa" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/wenzong_xia@outlook.com" title="E-Mail → wenzong_xia@outlook.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wzxiaa</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">32k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">29 mins.</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey   : 'AIzaSyC9jh958P_i4Xf6CbdafMTgFBZBlSVElPA',
      projectId: 'blog-d2861'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page
      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = CONFIG.hostname === location.hostname;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>




      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
